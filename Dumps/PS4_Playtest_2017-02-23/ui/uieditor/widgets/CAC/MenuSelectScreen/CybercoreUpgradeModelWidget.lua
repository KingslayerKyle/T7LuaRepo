require( "ui.uieditor.widgets.AbilityWheel.AbilityWheel_ColorPanel" )
require( "ui.uieditor.widgets.CAC.cac_ButtonBoxLrgInactiveDiags" )
require( "ui.uieditor.widgets.CAC.cac_lock" )
require( "ui.uieditor.widgets.CAC.SystemOverloardHeader" )
require( "ui.uieditor.widgets.Lobby.Common.FE_FocusBarContainer" )

CoD.CybercoreUpgradeModelWidget = InheritFrom( LUI.UIElement )
CoD.CybercoreUpgradeModelWidget.new = function ( menu, controller )
	local self = LUI.UIElement.new()
	if PreLoadFunc then
		PreLoadFunc( self, controller )
	end
	self:setUseStencil( false )
	self:setClass( CoD.CybercoreUpgradeModelWidget )
	self.id = "CybercoreUpgradeModelWidget"
	self.soundSet = "CAC_LethalGrenade"
	self:setLeftRight( 0, 0, 0, 180 )
	self:setTopBottom( 0, 0, 0, 180 )
	self:makeFocusable()
	self:setHandleMouse( true )
	self.anyChildUsesUpdateState = true
	
	local BoxButtonLrgIdle0 = LUI.UIImage.new()
	BoxButtonLrgIdle0:setLeftRight( 0, 1, 0, 0 )
	BoxButtonLrgIdle0:setTopBottom( 0, 1, 0, 0 )
	BoxButtonLrgIdle0:setAlpha( 0.8 )
	BoxButtonLrgIdle0:setImage( RegisterImage( "uie_t7_menu_cac_buttonboxlrgidlefull" ) )
	BoxButtonLrgIdle0:setMaterial( LUI.UIImage.GetCachedMaterial( "uie_nineslice_add" ) )
	BoxButtonLrgIdle0:setShaderVector( 0, 0, 0, 0, 0 )
	self:addElement( BoxButtonLrgIdle0 )
	self.BoxButtonLrgIdle0 = BoxButtonLrgIdle0
	
	local Outline = LUI.UIImage.new()
	Outline:setLeftRight( 0, 0, 4, 178 )
	Outline:setTopBottom( 0, 0, 6, 176 )
	Outline:setAlpha( 0 )
	Outline:setImage( RegisterImage( "uie_cp_outline_upgrade" ) )
	self:addElement( Outline )
	self.Outline = Outline
	
	local BoxButtonLrgInactive = LUI.UIImage.new()
	BoxButtonLrgInactive:setLeftRight( 0, 1, 0, 0 )
	BoxButtonLrgInactive:setTopBottom( 0, 1, 0, 0 )
	BoxButtonLrgInactive:setAlpha( 0 )
	BoxButtonLrgInactive:setImage( RegisterImage( "uie_t7_menu_cac_buttonboxlrginactivefull" ) )
	BoxButtonLrgInactive:setMaterial( LUI.UIImage.GetCachedMaterial( "uie_nineslice_add" ) )
	BoxButtonLrgInactive:setShaderVector( 0, 0, 0, 0, 0 )
	self:addElement( BoxButtonLrgInactive )
	self.BoxButtonLrgInactive = BoxButtonLrgInactive
	
	local abilityImage = LUI.UIImage.new()
	abilityImage:setLeftRight( 0, 1, 7, -47 )
	abilityImage:setTopBottom( 0, 1, 12, -48 )
	abilityImage:setAlpha( 0.85 )
	abilityImage:setupUIStreamedImage( 0 )
	abilityImage:linkToElementModel( self, "image", true, function ( model )
		local modelValue = Engine.GetModelValue( model )
		if modelValue then
			abilityImage:setImage( RegisterImage( modelValue ) )
		end
	end )
	self:addElement( abilityImage )
	self.abilityImage = abilityImage
	
	local debugImage = LUI.UIImage.new()
	debugImage:setLeftRight( 0.5, 0.5, -15, 15 )
	debugImage:setTopBottom( 0.5, 0.5, -15, 15 )
	debugImage:setRGB( 0, 1, 0 )
	debugImage:setAlpha( 0 )
	self:addElement( debugImage )
	self.debugImage = debugImage
	
	local LineLeft0 = LUI.UIImage.new()
	LineLeft0:setLeftRight( 0, 1, 71, 25 )
	LineLeft0:setTopBottom( 1, 1, -112, -106 )
	LineLeft0:setAlpha( 0.55 )
	LineLeft0:setZRot( 90 )
	LineLeft0:setImage( RegisterImage( "uie_t7_menu_frontend_featuredframeum" ) )
	LineLeft0:setMaterial( LUI.UIImage.GetCachedMaterial( "ui_add" ) )
	self:addElement( LineLeft0 )
	self.LineLeft0 = LineLeft0
	
	local BlackBox = LUI.UIImage.new()
	BlackBox:setLeftRight( 0, 1, 4, -4 )
	BlackBox:setTopBottom( 1, 1, -42, -3 )
	BlackBox:setRGB( 0.06, 0.03, 0.03 )
	BlackBox:setAlpha( 0.8 )
	self:addElement( BlackBox )
	self.BlackBox = BlackBox
	
	local AbilityName = LUI.UIText.new()
	AbilityName:setLeftRight( 0, 1, 12, -6 )
	AbilityName:setTopBottom( 1, 1, -34, -10 )
	AbilityName:setTTF( "fonts/RefrigeratorDeluxe-Regular.ttf" )
	AbilityName:setAlignment( Enum.LUIAlignment.LUI_ALIGNMENT_LEFT )
	AbilityName:setAlignment( Enum.LUIAlignment.LUI_ALIGNMENT_TOP )
	AbilityName:linkToElementModel( self, "name", true, function ( model )
		local modelValue = Engine.GetModelValue( model )
		if modelValue then
			AbilityName:setText( Engine.Localize( AppendStringIfRefExists( "_SHORT_NAME", modelValue ) ) )
		end
	end )
	self:addElement( AbilityName )
	self.AbilityName = AbilityName
	
	local BoxButtonLrgInactiveDiag = CoD.cac_ButtonBoxLrgInactiveDiags.new( menu, controller )
	BoxButtonLrgInactiveDiag:setLeftRight( 0, 1, -3, 3 )
	BoxButtonLrgInactiveDiag:setTopBottom( 0, 1, -3, 3 )
	BoxButtonLrgInactiveDiag:setAlpha( 0 )
	self:addElement( BoxButtonLrgInactiveDiag )
	self.BoxButtonLrgInactiveDiag = BoxButtonLrgInactiveDiag
	
	local Selected = LUI.UIImage.new()
	Selected:setLeftRight( 0, 0, -36, 212 )
	Selected:setTopBottom( 0, 0, -32, 216 )
	Selected:setAlpha( 0 )
	Selected:setImage( RegisterImage( "uie_cp_outline_upgrade" ) )
	Selected:setMaterial( LUI.UIImage.GetCachedMaterial( "uie_fractal" ) )
	Selected:setShaderVector( 0, 1.51, 0, 0, 0 )
	self:addElement( Selected )
	self.Selected = Selected
	
	local TokenImage0 = LUI.UIImage.new()
	TokenImage0:setLeftRight( 0, 0, 7, 40 )
	TokenImage0:setTopBottom( 1, 1, -78, -45 )
	TokenImage0:setImage( RegisterImage( "uie_img_t7_menu_cacselection_icontokenlarge_cp" ) )
	TokenImage0:setMaterial( LUI.UIImage.GetCachedMaterial( "ui_add" ) )
	self:addElement( TokenImage0 )
	self.TokenImage0 = TokenImage0
	
	local SystemOverloardHeader = CoD.SystemOverloardHeader.new( menu, controller )
	SystemOverloardHeader:setLeftRight( 0, 1, 5, -7 )
	SystemOverloardHeader:setTopBottom( 0, 1, 11, -147 )
	SystemOverloardHeader:setAlpha( 0 )
	self:addElement( SystemOverloardHeader )
	self.SystemOverloardHeader = SystemOverloardHeader
	
	local TitleImagebacking = LUI.UIImage.new()
	TitleImagebacking:setLeftRight( 0, 0, 4, 176 )
	TitleImagebacking:setTopBottom( 0, 0, 5, 39 )
	TitleImagebacking:setRGB( 0.03, 0.02, 0.02 )
	TitleImagebacking:setAlpha( 0 )
	self:addElement( TitleImagebacking )
	self.TitleImagebacking = TitleImagebacking
	
	local TokenImage = LUI.UIImage.new()
	TokenImage:setLeftRight( 1, 1, -39, -6 )
	TokenImage:setTopBottom( 1, 1, -78, -45 )
	TokenImage:setImage( RegisterImage( "uie_img_t7_menu_cacselection_icontokenlarge_cp" ) )
	TokenImage:setMaterial( LUI.UIImage.GetCachedMaterial( "ui_add" ) )
	self:addElement( TokenImage )
	self.TokenImage = TokenImage
	
	local FocusBarB = CoD.FE_FocusBarContainer.new( menu, controller )
	FocusBarB:setLeftRight( 0, 1, -2, 2 )
	FocusBarB:setTopBottom( 0, 0, 177, 184 )
	FocusBarB:setAlpha( 0 )
	self:addElement( FocusBarB )
	self.FocusBarB = FocusBarB
	
	local FocusBarT = CoD.FE_FocusBarContainer.new( menu, controller )
	FocusBarT:setLeftRight( 0, 1, -1, 3 )
	FocusBarT:setTopBottom( 0, 0, -3, 0 )
	FocusBarT:setAlpha( 0 )
	self:addElement( FocusBarT )
	self.FocusBarT = FocusBarT
	
	local EquippedIcon = LUI.UIImage.new()
	EquippedIcon:setLeftRight( 1, 1, -39, -7 )
	EquippedIcon:setTopBottom( 0, 0, 11, 43 )
	EquippedIcon:setRGB( 0.5, 0.5, 0.5 )
	EquippedIcon:setAlpha( 0.5 )
	EquippedIcon:setScale( 0.8 )
	EquippedIcon:setImage( RegisterImage( "t7_hud_cac_equipped_16" ) )
	self:addElement( EquippedIcon )
	self.EquippedIcon = EquippedIcon
	
	local lockedIcon = CoD.cac_lock.new( menu, controller )
	lockedIcon:setLeftRight( 0.5, 0.5, -36, 36 )
	lockedIcon:setTopBottom( 0.5, 0.5, -52, 31 )
	lockedIcon:setAlpha( 0 )
	lockedIcon.lockedIcon:setAlpha( 0 )
	self:addElement( lockedIcon )
	self.lockedIcon = lockedIcon
	
	local PanelGlow = LUI.UIImage.new()
	PanelGlow:setLeftRight( 0, 0, 9, 135 )
	PanelGlow:setTopBottom( 0, 0, 6, 126 )
	PanelGlow:setRGB( 0.97, 0.36, 0.07 )
	PanelGlow:setAlpha( 0 )
	PanelGlow:setScale( 0.9 )
	PanelGlow:setImage( RegisterImage( "uie_t7_core_hud_mapwidget_panelglow" ) )
	PanelGlow:setMaterial( LUI.UIImage.GetCachedMaterial( "ui_add" ) )
	self:addElement( PanelGlow )
	self.PanelGlow = PanelGlow
	
	local AbilityWheelColorPanel0 = CoD.AbilityWheel_ColorPanel.new( menu, controller )
	AbilityWheelColorPanel0:mergeStateConditions( {
		{
			stateName = "ControlCore",
			condition = function ( menu, element, event )
				return IsSelfModelValueEqualTo( element, controller, "core", "cybercore_control" )
			end
		},
		{
			stateName = "MartialCore",
			condition = function ( menu, element, event )
				return IsSelfModelValueEqualTo( element, controller, "core", "cybercore_martial" )
			end
		},
		{
			stateName = "ChaosCore",
			condition = function ( menu, element, event )
				return IsSelfModelValueEqualTo( element, controller, "core", "cybercore_chaos" )
			end
		}
	} )
	AbilityWheelColorPanel0:linkToElementModel( AbilityWheelColorPanel0, "core", true, function ( model )
		menu:updateElementState( AbilityWheelColorPanel0, {
			name = "model_validation",
			menu = menu,
			modelValue = Engine.GetModelValue( model ),
			modelName = "core"
		} )
	end )
	AbilityWheelColorPanel0:setLeftRight( 0, 1, 0, 0 )
	AbilityWheelColorPanel0:setTopBottom( 0, 1, 0, 0 )
	AbilityWheelColorPanel0:setAlpha( 0.85 )
	AbilityWheelColorPanel0:linkToElementModel( self, nil, false, function ( model )
		AbilityWheelColorPanel0:setModel( model, controller )
	end )
	self:addElement( AbilityWheelColorPanel0 )
	self.AbilityWheelColorPanel0 = AbilityWheelColorPanel0
	
	local UpgradedIndicator = LUI.UIImage.new()
	UpgradedIndicator:setLeftRight( 0, 0, 144, 171 )
	UpgradedIndicator:setTopBottom( 0, 0, 12, 39 )
	UpgradedIndicator:setAlpha( 0.5 )
	UpgradedIndicator:setImage( RegisterImage( "uie_t7_cac_cp_upgrade0_icon" ) )
	self:addElement( UpgradedIndicator )
	self.UpgradedIndicator = UpgradedIndicator
	
	local UpgradableIcon = LUI.UIImage.new()
	UpgradableIcon:setLeftRight( 0, 0, 143, 171 )
	UpgradableIcon:setTopBottom( 0, 0, 12, 39 )
	UpgradableIcon:setAlpha( 0 )
	UpgradableIcon:setImage( RegisterImage( "uie_t7_cac_cp_upgrade_icon" ) )
	self:addElement( UpgradableIcon )
	self.UpgradableIcon = UpgradableIcon
	
	self.resetProperties = function ()
		debugImage:completeAnimation()
		TokenImage:completeAnimation()
		AbilityWheelColorPanel0:completeAnimation()
		TokenImage0:completeAnimation()
		EquippedIcon:completeAnimation()
		UpgradedIndicator:completeAnimation()
		UpgradableIcon:completeAnimation()
		abilityImage:completeAnimation()
		FocusBarT:completeAnimation()
		FocusBarB:completeAnimation()
		BoxButtonLrgInactive:completeAnimation()
		PanelGlow:completeAnimation()
		Selected:completeAnimation()
		Outline:completeAnimation()
		lockedIcon:completeAnimation()
		LineLeft0:completeAnimation()
		BoxButtonLrgInactiveDiag:completeAnimation()
		AbilityName:completeAnimation()
		debugImage:setRGB( 0, 1, 0 )
		TokenImage:setAlpha( 1 )
		AbilityWheelColorPanel0:setAlpha( 0.85 )
		TokenImage0:setAlpha( 1 )
		EquippedIcon:setRGB( 0.5, 0.5, 0.5 )
		EquippedIcon:setAlpha( 0.5 )
		UpgradedIndicator:setAlpha( 0.5 )
		UpgradableIcon:setLeftRight( 0, 0, 143, 171 )
		UpgradableIcon:setTopBottom( 0, 0, 12, 39 )
		UpgradableIcon:setAlpha( 0 )
		abilityImage:setAlpha( 0.85 )
		FocusBarT:setLeftRight( 0, 1, -1, 3 )
		FocusBarT:setTopBottom( 0, 0, -3, 0 )
		FocusBarT:setAlpha( 0 )
		FocusBarB:setLeftRight( 0, 1, -2, 2 )
		FocusBarB:setTopBottom( 0, 0, 177, 184 )
		FocusBarB:setAlpha( 0 )
		BoxButtonLrgInactive:setAlpha( 0 )
		PanelGlow:setLeftRight( 0, 0, 9, 135 )
		PanelGlow:setTopBottom( 0, 0, 6, 126 )
		Selected:setLeftRight( 0, 0, -36, 212 )
		Selected:setTopBottom( 0, 0, -32, 216 )
		Outline:setLeftRight( 0, 0, 4, 178 )
		Outline:setTopBottom( 0, 0, 6, 176 )
		lockedIcon:setAlpha( 0 )
		LineLeft0:setAlpha( 0.55 )
		BoxButtonLrgInactiveDiag:setAlpha( 0 )
		AbilityName:setAlpha( 1 )
	end
	
	self.clipsPerState = {
		DefaultState = {
			DefaultClip = function ()
				self.resetProperties()
				self:setupElementClipCounter( 7 )
				debugImage:completeAnimation()
				self.debugImage:setRGB( 1, 1, 1 )
				self.clipFinished( debugImage, {} )
				TokenImage0:completeAnimation()
				self.TokenImage0:setAlpha( 0 )
				self.clipFinished( TokenImage0, {} )
				TokenImage:completeAnimation()
				self.TokenImage:setAlpha( 0 )
				self.clipFinished( TokenImage, {} )
				EquippedIcon:completeAnimation()
				self.EquippedIcon:setAlpha( 0 )
				self.clipFinished( EquippedIcon, {} )
				AbilityWheelColorPanel0:completeAnimation()
				self.AbilityWheelColorPanel0:setAlpha( 0 )
				self.clipFinished( AbilityWheelColorPanel0, {} )
				UpgradedIndicator:completeAnimation()
				self.UpgradedIndicator:setAlpha( 0 )
				self.clipFinished( UpgradedIndicator, {} )
				UpgradableIcon:completeAnimation()
				self.UpgradableIcon:setLeftRight( 0, 0, -254, -62 )
				self.UpgradableIcon:setTopBottom( 0, 0, -114.5, 77.5 )
				self.clipFinished( UpgradableIcon, {} )
			end,
			Focus = function ()
				self.resetProperties()
				self:setupElementClipCounter( 9 )
				BoxButtonLrgInactive:completeAnimation()
				self.BoxButtonLrgInactive:setAlpha( 1 )
				self.clipFinished( BoxButtonLrgInactive, {} )
				abilityImage:completeAnimation()
				self.abilityImage:setAlpha( 0.82 )
				self.clipFinished( abilityImage, {} )
				TokenImage0:completeAnimation()
				self.TokenImage0:setAlpha( 0 )
				self.clipFinished( TokenImage0, {} )
				TokenImage:completeAnimation()
				self.TokenImage:setAlpha( 0 )
				self.clipFinished( TokenImage, {} )
				FocusBarB:completeAnimation()
				self.FocusBarB:setLeftRight( 0, 1, -5, 3 )
				self.FocusBarB:setTopBottom( 0, 0, 179, 186 )
				self.FocusBarB:setAlpha( 1 )
				self.clipFinished( FocusBarB, {} )
				local FocusBarTFrame2 = function ( FocusBarT, event )
					if not event.interrupted then
						FocusBarT:beginAnimation( "keyframe", 750, false, false, CoD.TweenType.Linear )
					end
					FocusBarT:setLeftRight( 0, 1, -2, 2 )
					FocusBarT:setTopBottom( 0, 0, -3, 0 )
					FocusBarT:setAlpha( 1 )
					if event.interrupted then
						self.clipFinished( FocusBarT, event )
					else
						FocusBarT:registerEventHandler( "transition_complete_keyframe", self.clipFinished )
					end
				end
				
				FocusBarT:completeAnimation()
				self.FocusBarT:setLeftRight( 0, 1, -2, 2 )
				self.FocusBarT:setTopBottom( 0, 0, -3, 0 )
				self.FocusBarT:setAlpha( 1 )
				FocusBarTFrame2( FocusBarT, {} )
				EquippedIcon:completeAnimation()
				self.EquippedIcon:setAlpha( 0 )
				self.clipFinished( EquippedIcon, {} )
				PanelGlow:completeAnimation()
				self.PanelGlow:setLeftRight( 0, 0, 5, 183 )
				self.PanelGlow:setTopBottom( 0, 0, 0, 180 )
				self.clipFinished( PanelGlow, {} )
				local AbilityWheelColorPanel0Frame2 = function ( AbilityWheelColorPanel0, event )
					local AbilityWheelColorPanel0Frame3 = function ( AbilityWheelColorPanel0, event )
						if not event.interrupted then
							AbilityWheelColorPanel0:beginAnimation( "keyframe", 559, false, false, CoD.TweenType.Linear )
						end
						AbilityWheelColorPanel0:setAlpha( 0.8 )
						if event.interrupted then
							self.clipFinished( AbilityWheelColorPanel0, event )
						else
							AbilityWheelColorPanel0:registerEventHandler( "transition_complete_keyframe", self.clipFinished )
						end
					end
					
					if event.interrupted then
						AbilityWheelColorPanel0Frame3( AbilityWheelColorPanel0, event )
						return 
					else
						AbilityWheelColorPanel0:beginAnimation( "keyframe", 750, false, false, CoD.TweenType.Linear )
						AbilityWheelColorPanel0:setAlpha( 1 )
						AbilityWheelColorPanel0:registerEventHandler( "transition_complete_keyframe", AbilityWheelColorPanel0Frame3 )
					end
				end
				
				AbilityWheelColorPanel0:completeAnimation()
				self.AbilityWheelColorPanel0:setAlpha( 0 )
				AbilityWheelColorPanel0Frame2( AbilityWheelColorPanel0, {} )
			end
		},
		Unavailable = {
			DefaultClip = function ()
				self.resetProperties()
				self:setupElementClipCounter( 13 )
				Outline:completeAnimation()
				self.Outline:setLeftRight( 0, 0, 4, 178 )
				self.Outline:setTopBottom( 0, 0, 6.5, 195.5 )
				self.clipFinished( Outline, {} )
				abilityImage:completeAnimation()
				self.abilityImage:setAlpha( 0 )
				self.clipFinished( abilityImage, {} )
				debugImage:completeAnimation()
				self.debugImage:setRGB( 0, 0, 0 )
				self.clipFinished( debugImage, {} )
				LineLeft0:completeAnimation()
				self.LineLeft0:setAlpha( 0 )
				self.clipFinished( LineLeft0, {} )
				AbilityName:completeAnimation()
				self.AbilityName:setAlpha( 0.5 )
				self.clipFinished( AbilityName, {} )
				BoxButtonLrgInactiveDiag:completeAnimation()
				self.BoxButtonLrgInactiveDiag:setAlpha( 1 )
				self.clipFinished( BoxButtonLrgInactiveDiag, {} )
				Selected:completeAnimation()
				self.Selected:setLeftRight( 0, 0, -37.5, 211.5 )
				self.Selected:setTopBottom( 0, 0, -31.5, 217.5 )
				self.clipFinished( Selected, {} )
				TokenImage0:completeAnimation()
				self.TokenImage0:setAlpha( 0 )
				self.clipFinished( TokenImage0, {} )
				TokenImage:completeAnimation()
				self.TokenImage:setAlpha( 0 )
				self.clipFinished( TokenImage, {} )
				EquippedIcon:completeAnimation()
				self.EquippedIcon:setAlpha( 0 )
				self.clipFinished( EquippedIcon, {} )
				lockedIcon:completeAnimation()
				self.lockedIcon:setAlpha( 0.82 )
				self.clipFinished( lockedIcon, {} )
				AbilityWheelColorPanel0:completeAnimation()
				self.AbilityWheelColorPanel0:setAlpha( 0 )
				self.clipFinished( AbilityWheelColorPanel0, {} )
				UpgradedIndicator:completeAnimation()
				self.UpgradedIndicator:setAlpha( 0 )
				self.clipFinished( UpgradedIndicator, {} )
			end,
			Focus = function ()
				self.resetProperties()
				self:setupElementClipCounter( 11 )
				abilityImage:completeAnimation()
				self.abilityImage:setAlpha( 0 )
				self.clipFinished( abilityImage, {} )
				debugImage:completeAnimation()
				self.debugImage:setRGB( 0, 0, 0 )
				self.clipFinished( debugImage, {} )
				AbilityName:completeAnimation()
				self.AbilityName:setAlpha( 0.5 )
				self.clipFinished( AbilityName, {} )
				BoxButtonLrgInactiveDiag:completeAnimation()
				self.BoxButtonLrgInactiveDiag:setAlpha( 1 )
				self.clipFinished( BoxButtonLrgInactiveDiag, {} )
				TokenImage0:completeAnimation()
				self.TokenImage0:setAlpha( 0 )
				self.clipFinished( TokenImage0, {} )
				TokenImage:completeAnimation()
				self.TokenImage:setAlpha( 0 )
				self.clipFinished( TokenImage, {} )
				FocusBarB:completeAnimation()
				self.FocusBarB:setLeftRight( 0, 1, -3, 5 )
				self.FocusBarB:setTopBottom( 0, 0, 180, 187 )
				self.FocusBarB:setAlpha( 1 )
				self.clipFinished( FocusBarB, {} )
				FocusBarT:completeAnimation()
				self.FocusBarT:setAlpha( 1 )
				self.clipFinished( FocusBarT, {} )
				EquippedIcon:completeAnimation()
				self.EquippedIcon:setAlpha( 0 )
				self.clipFinished( EquippedIcon, {} )
				lockedIcon:completeAnimation()
				self.lockedIcon:setAlpha( 1 )
				self.clipFinished( lockedIcon, {} )
				AbilityWheelColorPanel0:completeAnimation()
				self.AbilityWheelColorPanel0:setAlpha( 0 )
				self.clipFinished( AbilityWheelColorPanel0, {} )
			end
		},
		Purchasable = {
			DefaultClip = function ()
				self.resetProperties()
				self:setupElementClipCounter( 4 )
				TokenImage:completeAnimation()
				self.TokenImage:setAlpha( 0 )
				self.clipFinished( TokenImage, {} )
				EquippedIcon:completeAnimation()
				self.EquippedIcon:setAlpha( 0 )
				self.clipFinished( EquippedIcon, {} )
				AbilityWheelColorPanel0:completeAnimation()
				self.AbilityWheelColorPanel0:setAlpha( 0 )
				self.clipFinished( AbilityWheelColorPanel0, {} )
				UpgradedIndicator:completeAnimation()
				self.UpgradedIndicator:setAlpha( 0 )
				self.clipFinished( UpgradedIndicator, {} )
			end,
			Focus = function ()
				self.resetProperties()
				self:setupElementClipCounter( 7 )
				BoxButtonLrgInactive:completeAnimation()
				self.BoxButtonLrgInactive:setAlpha( 1 )
				self.clipFinished( BoxButtonLrgInactive, {} )
				abilityImage:completeAnimation()
				self.abilityImage:setAlpha( 0.82 )
				self.clipFinished( abilityImage, {} )
				TokenImage:completeAnimation()
				self.TokenImage:setAlpha( 0 )
				self.clipFinished( TokenImage, {} )
				FocusBarB:completeAnimation()
				self.FocusBarB:setAlpha( 1 )
				self.clipFinished( FocusBarB, {} )
				FocusBarT:completeAnimation()
				self.FocusBarT:setAlpha( 1 )
				self.clipFinished( FocusBarT, {} )
				EquippedIcon:completeAnimation()
				self.EquippedIcon:setRGB( 0.5, 0.5, 0.5 )
				self.EquippedIcon:setAlpha( 0 )
				self.clipFinished( EquippedIcon, {} )
				AbilityWheelColorPanel0:completeAnimation()
				self.AbilityWheelColorPanel0:setAlpha( 0 )
				self.clipFinished( AbilityWheelColorPanel0, {} )
			end
		},
		Upgradable = {
			DefaultClip = function ()
				self.resetProperties()
				self:setupElementClipCounter( 5 )
				debugImage:completeAnimation()
				self.debugImage:setRGB( 0, 0, 1 )
				self.clipFinished( debugImage, {} )
				TokenImage0:completeAnimation()
				self.TokenImage0:setAlpha( 0 )
				self.clipFinished( TokenImage0, {} )
				EquippedIcon:completeAnimation()
				self.EquippedIcon:setRGB( 0.5, 0.5, 0.5 )
				self.EquippedIcon:setAlpha( 0 )
				self.clipFinished( EquippedIcon, {} )
				AbilityWheelColorPanel0:completeAnimation()
				self.AbilityWheelColorPanel0:setAlpha( 0.7 )
				self.clipFinished( AbilityWheelColorPanel0, {} )
				UpgradedIndicator:completeAnimation()
				self.UpgradedIndicator:setAlpha( 1 )
				self.clipFinished( UpgradedIndicator, {} )
			end,
			Focus = function ()
				self.resetProperties()
				self:setupElementClipCounter( 9 )
				BoxButtonLrgInactive:completeAnimation()
				self.BoxButtonLrgInactive:setAlpha( 1 )
				self.clipFinished( BoxButtonLrgInactive, {} )
				abilityImage:completeAnimation()
				self.abilityImage:setAlpha( 0.8 )
				self.clipFinished( abilityImage, {} )
				debugImage:completeAnimation()
				self.debugImage:setRGB( 0, 0, 1 )
				self.clipFinished( debugImage, {} )
				TokenImage0:completeAnimation()
				self.TokenImage0:setAlpha( 0 )
				self.clipFinished( TokenImage0, {} )
				FocusBarB:completeAnimation()
				self.FocusBarB:setAlpha( 1 )
				self.clipFinished( FocusBarB, {} )
				FocusBarT:completeAnimation()
				self.FocusBarT:setAlpha( 1 )
				self.clipFinished( FocusBarT, {} )
				EquippedIcon:completeAnimation()
				self.EquippedIcon:setRGB( 0.5, 0.5, 0.5 )
				self.EquippedIcon:setAlpha( 0 )
				self.clipFinished( EquippedIcon, {} )
				AbilityWheelColorPanel0:completeAnimation()
				self.AbilityWheelColorPanel0:setAlpha( 0.5 )
				self.clipFinished( AbilityWheelColorPanel0, {} )
				UpgradedIndicator:completeAnimation()
				self.UpgradedIndicator:setAlpha( 1 )
				self.clipFinished( UpgradedIndicator, {} )
			end
		},
		Upgraded = {
			DefaultClip = function ()
				self.resetProperties()
				self:setupElementClipCounter( 8 )
				Outline:completeAnimation()
				self.Outline:setLeftRight( 0, 0, 4, 178 )
				self.Outline:setTopBottom( 0, 0, 5.5, 176.5 )
				self.clipFinished( Outline, {} )
				debugImage:completeAnimation()
				self.debugImage:setRGB( 1, 0, 0 )
				self.clipFinished( debugImage, {} )
				TokenImage0:completeAnimation()
				self.TokenImage0:setAlpha( 0 )
				self.clipFinished( TokenImage0, {} )
				TokenImage:completeAnimation()
				self.TokenImage:setAlpha( 0 )
				self.clipFinished( TokenImage, {} )
				EquippedIcon:completeAnimation()
				self.EquippedIcon:setRGB( 0.55, 0.77, 0.25 )
				self.EquippedIcon:setAlpha( 0 )
				self.clipFinished( EquippedIcon, {} )
				AbilityWheelColorPanel0:completeAnimation()
				self.AbilityWheelColorPanel0:setAlpha( 0.7 )
				self.clipFinished( AbilityWheelColorPanel0, {} )
				UpgradedIndicator:completeAnimation()
				self.UpgradedIndicator:setAlpha( 0 )
				self.clipFinished( UpgradedIndicator, {} )
				UpgradableIcon:completeAnimation()
				self.UpgradableIcon:setAlpha( 1 )
				self.clipFinished( UpgradableIcon, {} )
			end,
			Focus = function ()
				self.resetProperties()
				self:setupElementClipCounter( 13 )
				Outline:completeAnimation()
				self.Outline:setLeftRight( 0, 0, 4, 178 )
				self.Outline:setTopBottom( 0, 0, 5.5, 176.5 )
				self.clipFinished( Outline, {} )
				BoxButtonLrgInactive:completeAnimation()
				self.BoxButtonLrgInactive:setAlpha( 1 )
				self.clipFinished( BoxButtonLrgInactive, {} )
				abilityImage:completeAnimation()
				self.abilityImage:setAlpha( 0.8 )
				self.clipFinished( abilityImage, {} )
				debugImage:completeAnimation()
				self.debugImage:setRGB( 1, 0, 0 )
				self.clipFinished( debugImage, {} )
				Selected:completeAnimation()
				self.Selected:setLeftRight( 0, 0, -40, 212 )
				self.Selected:setTopBottom( 0, 0, -33.5, 215.5 )
				self.clipFinished( Selected, {} )
				TokenImage0:completeAnimation()
				self.TokenImage0:setAlpha( 0 )
				self.clipFinished( TokenImage0, {} )
				TokenImage:completeAnimation()
				self.TokenImage:setAlpha( 0 )
				self.clipFinished( TokenImage, {} )
				FocusBarB:completeAnimation()
				self.FocusBarB:setAlpha( 1 )
				self.clipFinished( FocusBarB, {} )
				FocusBarT:completeAnimation()
				self.FocusBarT:setAlpha( 1 )
				self.clipFinished( FocusBarT, {} )
				EquippedIcon:completeAnimation()
				self.EquippedIcon:setRGB( 0.55, 0.77, 0.25 )
				self.EquippedIcon:setAlpha( 0 )
				self.clipFinished( EquippedIcon, {} )
				AbilityWheelColorPanel0:completeAnimation()
				self.AbilityWheelColorPanel0:setAlpha( 0.5 )
				self.clipFinished( AbilityWheelColorPanel0, {} )
				UpgradedIndicator:completeAnimation()
				self.UpgradedIndicator:setAlpha( 0 )
				self.clipFinished( UpgradedIndicator, {} )
				UpgradableIcon:completeAnimation()
				self.UpgradableIcon:setAlpha( 1 )
				self.clipFinished( UpgradableIcon, {} )
			end,
			LoseFocus = function ()
				self.resetProperties()
				self:setupElementClipCounter( 7 )
				Selected:completeAnimation()
				self.Selected:setLeftRight( 0, 0, -37.5, 211.5 )
				self.Selected:setTopBottom( 0, 0, -33.5, 215.5 )
				self.clipFinished( Selected, {} )
				TokenImage0:completeAnimation()
				self.TokenImage0:setAlpha( 0 )
				self.clipFinished( TokenImage0, {} )
				TokenImage:completeAnimation()
				self.TokenImage:setAlpha( 0 )
				self.clipFinished( TokenImage, {} )
				EquippedIcon:completeAnimation()
				self.EquippedIcon:setRGB( 0.55, 0.77, 0.25 )
				self.EquippedIcon:setAlpha( 0 )
				self.clipFinished( EquippedIcon, {} )
				AbilityWheelColorPanel0:completeAnimation()
				self.AbilityWheelColorPanel0:setAlpha( 0.7 )
				self.clipFinished( AbilityWheelColorPanel0, {} )
				UpgradedIndicator:completeAnimation()
				self.UpgradedIndicator:setAlpha( 0 )
				self.clipFinished( UpgradedIndicator, {} )
				UpgradableIcon:completeAnimation()
				self.UpgradableIcon:setAlpha( 1 )
				self.clipFinished( UpgradableIcon, {} )
			end
		}
	}
	self:mergeStateConditions( {
		{
			stateName = "Unavailable",
			condition = function ( menu, element, event )
				return not IsCybercoreAbilityAvailable( element, controller )
			end
		},
		{
			stateName = "Purchasable",
			condition = function ( menu, element, event )
				return IsCybercoreAbilityPurchasable( element, controller )
			end
		},
		{
			stateName = "Upgradable",
			condition = function ( menu, element, event )
				return IsCybercoreAbilityUpgradable( element, controller )
			end
		},
		{
			stateName = "Upgraded",
			condition = function ( menu, element, event )
				return IsCybercoreAbilityUpgraded( element, controller )
			end
		}
	} )
	SystemOverloardHeader.id = "SystemOverloardHeader"
	self:registerEventHandler( "gain_focus", function ( self, event )
		if self.m_focusable and self.SystemOverloardHeader:processEvent( event ) then
			return true
		else
			return LUI.UIElement.gainFocus( self, event )
		end
	end )
	LUI.OverrideFunction_CallOriginalSecond( self, "close", function ( self )
		self.BoxButtonLrgInactiveDiag:close()
		self.SystemOverloardHeader:close()
		self.FocusBarB:close()
		self.FocusBarT:close()
		self.lockedIcon:close()
		self.AbilityWheelColorPanel0:close()
		self.abilityImage:close()
		self.AbilityName:close()
	end )
	if PostLoadFunc then
		PostLoadFunc( self, controller, menu )
	end
	return self
end

