CoD.GridItemButton_Internal = InheritFrom( LUI.UIElement )
CoD.GridItemButton_Internal.new = function ( menu, controller )
	local self = LUI.UIElement.new()
	if PreLoadFunc then
		PreLoadFunc( self, controller )
	end
	self:setUseStencil( false )
	self:setClass( CoD.GridItemButton_Internal )
	self.id = "GridItemButton_Internal"
	self.soundSet = "default"
	self:setLeftRight( true, false, 0, 108 )
	self:setTopBottom( true, false, 0, 108 )
	self:makeFocusable()
	self:setHandleMouse( true )
	
	local itemImage = LUI.UIImage.new()
	itemImage:setLeftRight( true, true, 16.5, -16.5 )
	itemImage:setTopBottom( true, true, 8, -25 )
	itemImage:setRGB( 1, 1, 1 )
	itemImage:setMaterial( LUI.UIImage.GetCachedMaterial( "ui_normal" ) )
	itemImage:linkToElementModel( self, "image", true, function ( model )
		local modelValue = Engine.GetModelValue( model )
		if modelValue then
			itemImage:setImage( RegisterImage( modelValue ) )
		end
	end )
	self:addElement( itemImage )
	self.itemImage = itemImage
	
	local lockedIcon = LUI.UIImage.new()
	lockedIcon:setLeftRight( false, false, -16, 16 )
	lockedIcon:setTopBottom( false, false, -16, 16 )
	lockedIcon:setRGB( 1, 1, 1 )
	lockedIcon:setAlpha( 0 )
	lockedIcon:setImage( RegisterImage( "uie_t7_hud_cac_lock_64" ) )
	lockedIcon:setMaterial( LUI.UIImage.GetCachedMaterial( "ui_normal" ) )
	self:addElement( lockedIcon )
	self.lockedIcon = lockedIcon
	
	local notAvailableIcon = LUI.UIImage.new()
	notAvailableIcon:setLeftRight( false, false, -49, 49 )
	notAvailableIcon:setTopBottom( false, false, -24.25, 24.25 )
	notAvailableIcon:setRGB( 1, 1, 1 )
	notAvailableIcon:setAlpha( 0 )
	notAvailableIcon:setImage( RegisterImage( "uie_combat_tab_knife" ) )
	notAvailableIcon:setMaterial( LUI.UIImage.GetCachedMaterial( "ui_normal" ) )
	self:addElement( notAvailableIcon )
	self.notAvailableIcon = notAvailableIcon
	
	local equippedIcon = LUI.UIImage.new()
	equippedIcon:setLeftRight( false, false, 39, 53 )
	equippedIcon:setTopBottom( false, false, -53, -39 )
	equippedIcon:setRGB( 0.55, 0.77, 0.25 )
	equippedIcon:setAlpha( 0 )
	equippedIcon:setImage( RegisterImage( "uie_t7_hud_cac_equipped_16" ) )
	equippedIcon:setMaterial( LUI.UIImage.GetCachedMaterial( "ui_normal" ) )
	self:addElement( equippedIcon )
	self.equippedIcon = equippedIcon
	
	local tokenIconOld = LUI.UIImage.new()
	tokenIconOld:setLeftRight( false, false, 37, 53 )
	tokenIconOld:setTopBottom( false, false, -53, -37 )
	tokenIconOld:setRGB( 1, 1, 1 )
	tokenIconOld:setAlpha( 0 )
	tokenIconOld:setImage( RegisterImage( "uie_t7_hud_playerlist_unobtanium" ) )
	tokenIconOld:setMaterial( LUI.UIImage.GetCachedMaterial( "ui_normal" ) )
	self:addElement( tokenIconOld )
	self.tokenIconOld = tokenIconOld
	
	local alertIcon = LUI.UIImage.new()
	alertIcon:setLeftRight( false, false, 39.25, 53.25 )
	alertIcon:setTopBottom( false, false, -53, -39 )
	alertIcon:setRGB( 1, 0.41, 0 )
	alertIcon:setAlpha( 0 )
	alertIcon:setImage( RegisterImage( "uie_t7_hud_cac_warning_16" ) )
	alertIcon:setMaterial( LUI.UIImage.GetCachedMaterial( "ui_normal" ) )
	self:addElement( alertIcon )
	self.alertIcon = alertIcon
	
	local itemLabel = LUI.UIText.new()
	itemLabel:setLeftRight( true, true, 0, 0 )
	itemLabel:setTopBottom( false, true, -20, -4 )
	itemLabel:setRGB( 0.78, 0.8, 0.64 )
	itemLabel:setTTF( "fonts/UnitedSansSmCdMd.ttf" )
	itemLabel:setAlignment( Enum.LUIAlignment.LUI_ALIGNMENT_CENTER )
	itemLabel:setAlignment( Enum.LUIAlignment.LUI_ALIGNMENT_TOP )
	itemLabel:linkToElementModel( self, "name", true, function ( model )
		local modelValue = Engine.GetModelValue( model )
		if modelValue then
			itemLabel:setText( Engine.Localize( modelValue ) )
		end
	end )
	self:addElement( itemLabel )
	self.itemLabel = itemLabel
	
	local tokenIcon = LUI.UIImage.new()
	tokenIcon:setLeftRight( false, false, 38.42, 54 )
	tokenIcon:setTopBottom( false, false, -54, -37 )
	tokenIcon:setRGB( 1, 1, 1 )
	tokenIcon:setAlpha( 0 )
	tokenIcon:setImage( RegisterImage( "uie_img_t7_menu_cacselection_icontokenlarge" ) )
	tokenIcon:setMaterial( LUI.UIImage.GetCachedMaterial( "ui_add" ) )
	self:addElement( tokenIcon )
	self.tokenIcon = tokenIcon
	
	self.clipsPerState = {
		DefaultState = {
			DefaultClip = function ()
				self:setupElementClipCounter( 7 )
				itemImage:completeAnimation()
				self.itemImage:setAlpha( 1 )
				self.clipFinished( itemImage, {} )
				lockedIcon:completeAnimation()
				self.lockedIcon:setAlpha( 0 )
				self.clipFinished( lockedIcon, {} )
				notAvailableIcon:completeAnimation()
				self.notAvailableIcon:setAlpha( 0 )
				self.clipFinished( notAvailableIcon, {} )
				equippedIcon:completeAnimation()
				self.equippedIcon:setAlpha( 0 )
				self.clipFinished( equippedIcon, {} )
				tokenIconOld:completeAnimation()
				self.tokenIconOld:setAlpha( 0 )
				self.clipFinished( tokenIconOld, {} )
				alertIcon:completeAnimation()
				self.alertIcon:setAlpha( 0 )
				self.clipFinished( alertIcon, {} )
				itemLabel:completeAnimation()
				self.itemLabel:setRGB( 0.78, 0.8, 0.64 )
				self.clipFinished( itemLabel, {} )
			end,
			Focus = function ()
				self:setupElementClipCounter( 1 )
				itemLabel:completeAnimation()
				self.itemLabel:setRGB( 1, 1, 1 )
				self.clipFinished( itemLabel, {} )
			end
		},
		Equipped = {
			DefaultClip = function ()
				self:setupElementClipCounter( 6 )
				itemImage:completeAnimation()
				self.itemImage:setAlpha( 1 )
				self.clipFinished( itemImage, {} )
				lockedIcon:completeAnimation()
				self.lockedIcon:setAlpha( 0 )
				self.clipFinished( lockedIcon, {} )
				notAvailableIcon:completeAnimation()
				self.notAvailableIcon:setAlpha( 0 )
				self.clipFinished( notAvailableIcon, {} )
				equippedIcon:completeAnimation()
				self.equippedIcon:setAlpha( 1 )
				self.clipFinished( equippedIcon, {} )
				tokenIconOld:completeAnimation()
				self.tokenIconOld:setAlpha( 0 )
				self.clipFinished( tokenIconOld, {} )
				alertIcon:completeAnimation()
				self.alertIcon:setAlpha( 0 )
				self.clipFinished( alertIcon, {} )
			end
		},
		NotAvailable = {
			DefaultClip = function ()
				self:setupElementClipCounter( 6 )
				itemImage:completeAnimation()
				self.itemImage:setAlpha( 0 )
				self.clipFinished( itemImage, {} )
				lockedIcon:completeAnimation()
				self.lockedIcon:setAlpha( 0 )
				self.clipFinished( lockedIcon, {} )
				notAvailableIcon:completeAnimation()
				self.notAvailableIcon:setAlpha( 1 )
				self.clipFinished( notAvailableIcon, {} )
				equippedIcon:completeAnimation()
				self.equippedIcon:setAlpha( 0 )
				self.clipFinished( equippedIcon, {} )
				tokenIconOld:completeAnimation()
				self.tokenIconOld:setAlpha( 0 )
				self.clipFinished( tokenIconOld, {} )
				alertIcon:completeAnimation()
				self.alertIcon:setAlpha( 0 )
				self.clipFinished( alertIcon, {} )
			end
		},
		Locked = {
			DefaultClip = function ()
				self:setupElementClipCounter( 6 )
				itemImage:completeAnimation()
				self.itemImage:setAlpha( 0 )
				self.clipFinished( itemImage, {} )
				lockedIcon:completeAnimation()
				self.lockedIcon:setAlpha( 1 )
				self.clipFinished( lockedIcon, {} )
				notAvailableIcon:completeAnimation()
				self.notAvailableIcon:setAlpha( 0 )
				self.clipFinished( notAvailableIcon, {} )
				equippedIcon:completeAnimation()
				self.equippedIcon:setAlpha( 0 )
				self.clipFinished( equippedIcon, {} )
				tokenIconOld:completeAnimation()
				self.tokenIconOld:setAlpha( 0 )
				self.clipFinished( tokenIconOld, {} )
				alertIcon:completeAnimation()
				self.alertIcon:setAlpha( 0 )
				self.clipFinished( alertIcon, {} )
			end
		},
		MutuallyExclusive = {
			DefaultClip = function ()
				self:setupElementClipCounter( 6 )
				itemImage:completeAnimation()
				self.itemImage:setAlpha( 1 )
				self.clipFinished( itemImage, {} )
				lockedIcon:completeAnimation()
				self.lockedIcon:setAlpha( 0 )
				self.clipFinished( lockedIcon, {} )
				notAvailableIcon:completeAnimation()
				self.notAvailableIcon:setAlpha( 0 )
				self.clipFinished( notAvailableIcon, {} )
				equippedIcon:completeAnimation()
				self.equippedIcon:setAlpha( 0 )
				self.clipFinished( equippedIcon, {} )
				tokenIconOld:completeAnimation()
				self.tokenIconOld:setAlpha( 0 )
				self.clipFinished( tokenIconOld, {} )
				alertIcon:completeAnimation()
				self.alertIcon:setAlpha( 1 )
				self.clipFinished( alertIcon, {} )
			end,
			Large = function ()
				self:setupElementClipCounter( 6 )
				itemImage:completeAnimation()
				self.itemImage:setAlpha( 0 )
				self.clipFinished( itemImage, {} )
				lockedIcon:completeAnimation()
				self.lockedIcon:setAlpha( 0 )
				self.clipFinished( lockedIcon, {} )
				notAvailableIcon:completeAnimation()
				self.notAvailableIcon:setAlpha( 0 )
				self.clipFinished( notAvailableIcon, {} )
				equippedIcon:completeAnimation()
				self.equippedIcon:setAlpha( 0 )
				self.clipFinished( equippedIcon, {} )
				tokenIconOld:completeAnimation()
				self.tokenIconOld:setAlpha( 0 )
				self.clipFinished( tokenIconOld, {} )
				alertIcon:completeAnimation()
				self.alertIcon:setAlpha( 1 )
				self.clipFinished( alertIcon, {} )
			end
		}
	}
	self.close = function ( self )
		self.itemImage:close()
		self.itemLabel:close()
		CoD.GridItemButton_Internal.super.close( self )
	end
	
	if PostLoadFunc then
		PostLoadFunc( self, controller, menu )
	end
	return self
end

